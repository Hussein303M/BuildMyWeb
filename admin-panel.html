<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - BuildMyWeb</title>
<link rel="stylesheet" href="style.css">
<style>
.admin-actions {
    text-align: center;
    margin: 20px;
}
.admin-actions button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
}
.add-btn { background-color: #00bfff; color: #121212; }
.edit-btn { background-color: #ffa500; color: #121212; }
.delete-btn { background-color: #ff4d4d; color: #fff; }
.delete-all-btn { background-color: #cc0000; color: #fff; }
.export-btn { background-color: #4caf50; color: #fff; }
</style>
</head>
<body>
<header>
    <h1>Admin Panel</h1>
</header>

<!-- Admin Controls -->
<section class="admin-actions">
    <button class="add-btn" onclick="addBooking()">Add Booking</button>
    <button class="delete-all-btn" onclick="deleteAllBookings()">Delete All</button>
    <button class="export-btn" onclick="exportCSV()">Export CSV</button>
</section>

<!-- Appointments Table -->
<section id="appointments">
    <h2 style="text-align:center;">Appointments</h2>
    <table>
        <thead>
            <tr>
                <th>Slot</th>
                <th>Name</th>
                <th>Email</th>
                <th>Business</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="appointments-body"></tbody>
    </table>
</section>

<script>
// Redirect to login if not authenticated
if (sessionStorage.getItem("isAdmin") !== "true") {
    window.location.href = "admin.html";
}

const appointmentsBody = document.getElementById("appointments-body");

// Render all bookings
function renderBookings() {
    const bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    appointmentsBody.innerHTML = "";

    bookings.forEach((b, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${b.slot}</td>
            <td>${b.name}</td>
            <td>${b.email}</td>
            <td>${b.business}</td>
            <td>
                <button class="edit-btn" onclick="editBooking(${index})">Edit</button>
                <button class="delete-btn" onclick="deleteBooking(${index})">Delete</button>
            </td>
        `;
        appointmentsBody.appendChild(row);
    });
}

// Add booking
function addBooking() {
    const slot = prompt("Enter slot (e.g. 10:00 AM)");
    const name = prompt("Enter name");
    const email = prompt("Enter email");
    const business = prompt("Enter business");

    if (!slot || !name || !email || !business) return alert("All fields are required!");

    let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    bookings.push({ slot, name, email, business });
    localStorage.setItem("bookings", JSON.stringify(bookings));

    renderBookings();
}

// Edit booking
function editBooking(index) {
    let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    const booking = bookings[index];

    const newSlot = prompt("Edit slot", booking.slot);
    const newName = prompt("Edit name", booking.name);
    const newEmail = prompt("Edit email", booking.email);
    const newBusiness = prompt("Edit business", booking.business);

    bookings[index] = {
        slot: newSlot || booking.slot,
        name: newName || booking.name,
        email: newEmail || booking.email,
        business: newBusiness || booking.business,
    };

    localStorage.setItem("bookings", JSON.stringify(bookings));
    renderBookings();
}

// Delete single booking
function deleteBooking(index) {
    let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    bookings.splice(index, 1);
    localStorage.setItem("bookings", JSON.stringify(bookings));
    renderBookings();
}

// Delete all bookings
function deleteAllBookings() {
    if (confirm("Are you sure you want to delete ALL bookings?")) {
        localStorage.removeItem("bookings");
        localStorage.removeItem("bookedSlots");
        renderBookings();
    }
}

// Export bookings as CSV
function exportCSV() {
    const bookings = JSON.parse(localStorage.getItem("bookings")) || [];
    if (bookings.length === 0) return alert("No bookings to export!");

    let csv = "Slot,Name,Email,Business\n";
    bookings.forEach(b => {
        csv += `"${b.slot}","${b.name}","${b.email}","${b.business}"\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "bookings.csv";
    a.click();
    URL.revokeObjectURL(url);
}

// Initial render
renderBookings();

// Auto-refresh every 2s
setInterval(renderBookings, 2000);
</script>
</body>
</html>
